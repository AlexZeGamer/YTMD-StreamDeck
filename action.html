<!DOCTYPE html>
<html lang="en">
<head>
	<title>YouTube Music Desktop Connector</title>
	<meta charset="utf-8">
	<link rel="stylesheet" href="sdpi.css">
</head>
<body>
<div class="sdpi-wrapper">
	<div class="sdpi-item">
		<div class="sdpi-item-label">Host</div>
		<input class="sdpi-item-value" type="text" id="host" value="localhost">
	</div>
	<div class="sdpi-item">
		<div class="sdpi-item-label">Port</div>
		<input class="sdpi-item-value" type="number" id="port" value="9863">
	</div>
	<div class="sdpi-item">
		<div class="sdpi-item-label">Password</div>
		<input class="sdpi-item-value" type="password" id="password">
	</div>
	<div class="sdpi-item">
		<button class="sdpi-item-value" id="save">Save</button>
	</div>
</div>

<script>

    streamdeck.on('ready', function () {
        function updateValue(newSettings) {
            streamdeck.getSettings().then(settings => {
                settings = newSettings

                return streamdeck.setSettings(settings).then(settings => {
                    console.log(JSON.stringify(settings))
                    return streamdeck.setTitle(settings.hostData, 0);
                });
            }).catch(err => {
                console.error(err)
            });
        }

        const host = document.getElementById('host'),
            port = document.getElementById('port'),
            password = document.getElementById('password'),
            save = document.getElementById('save');

        streamdeck.getSettings().then(res => {
            console.log(JSON.stringify(res))
            const {hostData, portData, passwordData} = res;
            host.value = hostData || 'localhost';
            port.value = portData || 9863;
            password.value = passwordData || '';

        }).catch(err => {
            console.error(err);
        });

        save.onclick = () => {
            const hostData = host.value;
            const portData = port.value;
            const passwordData = password.value;
            updateValue({hostData, portData, passwordData});
        }
    });
</script>
</body>
</html>
